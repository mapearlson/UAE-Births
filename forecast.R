setwd("~/Documents/Delma/Births")
# Total and national fertility/crude birth rates are highly correlated.
# Thus, I will use total birth rates given the increase in the amount of historical
# data.
d <- read.csv("rate2.csv")
str(d)
dts <- ts(d$rate, start=c(1960, 1), end=c(2012, 1), frequency=1) 
dts <- ts(d)
plot(dts)

# simple exponential - models level
fitHW <- HoltWinters(dts, beta=FALSE, gamma=FALSE)
# double exponential - models level and trend
fitHW2 <- HoltWinters(dts, gamma=FALSE)
fitHW2.2 <- forecast.HoltWinters(fitHW2, h=7)
plot.forecast(fitHW2.2)

# predictive accuracy
install.packages("forecast")
library(forecast)
accuracy(fitHW)

# predict next three future values
forecast(fitHW2, 7)
plot(forecast(fitHW2, 7))

fitHW3 <- HoltWinters(dts, gamma=FALSE, l.start=48.290, b.start=-0.672)
plot(fitHW)

plot(forecast(fitHW3,7))
forecast(fitHW3, 7)

acf(fitHW2.2$residuals, lag.max=20)
Box.test(fitHW2.2$residuals, lag=20, type="Ljung-Box")

plot.ts(fitHW2.2$residuals)
plotForecastErrors(fitHW2.2$residuals)

###ARIMA
acf(dts)
pacf(dts)
dts.diff <- diff(dts, differences=1)
plot.ts(dts.diff)

install.packages("fUnitRoots")
library(fUnitRoots)
install. packages("fpp")
library(fpp)
############################
pop.ts <- ts(d$total.pop, start=c(1960, 1), end=c(2012, 1), frequency=1) 

# simple exponential - models level
popHW <- HoltWinters(pop.ts, beta=FALSE, gamma=FALSE)
# double exponential - models level and trend
popHW2 <- HoltWinters(pop.ts, gamma=FALSE)
popHW2.2 <- forecast.HoltWinters(popHW2, h=7)
plot.forecast(popHW2.2)

# predictive accuracy
install.packages("forecast")
library(forecast)
accuracy(fitHW)

# predict next three future values
forecast(popHW2, 7)
plot(forecast(fitHW2, 7))

fitHW3 <- HoltWinters(dts, gamma=FALSE, l.start=48.290, b.start=-0.672)
plot(fitHW)

plot(forecast(fitHW3,7))
forecast(fitHW3, 7)

acf(fitHW2.2$residuals, lag.max=20)
Box.test(fitHW2.2$residuals, lag=20, type="Ljung-Box")

plot.ts(fitHW2.2$residuals)
plotForecastErrors(fitHW2.2$residuals)

###ARIMA
acf(dts)
pacf(dts)

plot(diff(log(dts)))
ddts <- diff(log(dts))

acf(ddts, lag.max=20)
acf(ddts, lag.max=20, plot=FALSE)
pacf(ddts, lag.max=20) # plot a partial correlogram
pacf(ddts, lag.max=20, plot=FALSE) 
auto.arima(dts)

ddts.arima <- arima(dts, order=c(4,2,3))# fit an ARIMA(4,2,3) model
ddts.arima2 <- arima(dts, order=c(2,1,2))

arima.forecast <- forecast.Arima(ddts.arima, h=10)
arima.forecast
summary(arima.forecast)
plot(arima.forecast)

acf(arima.forecast$residuals, lag.max=20)
Box.test(arima.forecast$residuals, lag=20, type="Ljung-Box")
# Box-Ljung test
# data:  arima.forecast$residuals
# X-squared = 27.1241, df = 20, p-value = 0.1318

plot.ts(arima.forecast$residuals) # make time plot of forecast errors
plotForecastErrors(arima.forecast$residuals) # make a histogram
